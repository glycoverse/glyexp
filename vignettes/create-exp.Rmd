---
title: "Creating Experiments"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Creating Experiments}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette will guide you through creating an `experiment()` object from scratch.
Think of it as your step-by-step recipe for building the foundation of your glycomics analysis!

> **Quick tip:** If you're already using `glyread` to import your data,
you can focus on the "Sample Information" section and breeze through the rest.

```{r setup}
library(glyexp)
library(glyrepr)
library(tibble)
```

## What You'll Need

Creating an `experiment()` object is like assembling a puzzle â€“
you need three key pieces to make everything fit together perfectly:

- **Expression Matrix**: Your numeric data arranged with variables as rows and samples as columns (the heart of your dataset!)
- **Sample Information**: A tibble containing all the juicy details about your samples â€“ groups, batches, demographics, you name it
- **Variable Information**: A tibble describing your variables â€“ proteins, peptides, glycan compositions, and more

You'll also sprinkle in some experiment metadata to complete the picture.

Ready? Let's dive in!

## Step 1: Getting Your Samples Organized

Let's start with the sample information â€“ 
think of this as your sample's ID card plus all the important details about each one.

The golden rule here is simple: your first column **must** be named `sample`,
and every entry needs to be unique (no duplicates allowed!).
These are your sample identifiers â€“ the names that tie everything together.

For the remaining columns, you have complete freedom!
Add any information that matters for your analysis: groups, batches, patient demographics, treatment conditions â€“
whatever helps tell your story.

### Pro Tips for Column Names

The `glycoverse` family has some favorite column names that make everything work seamlessly:

- **`group`**: Your experimental conditions or treatments (and yes, make it a factor!).  
  This is your star player â€“ most `glystats` functions rely on this column.
- **`batch`**: For tracking sample batches (another factor, please!).  
  Essential for `glyclean::remove_batch_effect()`.
  No batch column? No problem â€“ `glyclean::auto_clean()` will simply skip batch correction.

> **Note:** We're constantly expanding this list, so stay tuned for more conventions!

Let's build our sample information table:

```{r}
sample_info <- tibble(
  sample = c("S1", "S2", "S3", "S4", "S5", "S6"),
  group = factor(c("A", "A", "A", "B", "B", "B"), levels = c("A", "B")),
  batch = factor(c(1, 2, 1, 2, 1, 2), levels = c(1, 2))
)
sample_info
```

## Step 2: Describing Your Variables

Now for the variable information â€“ this is where you describe what each measurement actually represents.

**Good news for glycoproteomics folks:** If you're using `glyread`, sit back and relax!
It automatically extracts all this information from your software output files.

**For glycomics experiments:** You'll likely need to build this manually, but don't worry â€“
glycomics data structures are much more straightforward than their glycoproteomics cousins.

### The Variable Naming Game

Just like with samples, your first column **must** be named `variable` with unique values.
Here's the thing though â€“ these names don't need to be fancy or meaningful.
In fact, `glyread` happily uses simple names like "V1", "V2", "V3" by default, and that works perfectly fine!

### Column Conventions by Experiment Type

**For glycomics experiments**, these columns are your friends:

- **`glycan_composition`**: Your glycan composition as a `glyrepr::glycan_composition()` object
- **`glycan_structure`**: Your glycan structure as a `glyrepr::glycan_structure()` object  
  (You *could* use character strings that `glyparse::auto_parse()` understands,
  but we recommend the parsed objects to avoid repetitive parsing later)

**For glycoproteomics experiments**, you'll want these additional columns:

- **`protein`**: UniProt accession (character)
- **`protein_site`**: Glycosylation site position on the protein (integer)
- **`gene`**: Gene name (character) â€“ *optional but nice to have*
- **`peptide`**: Peptide sequence (character) â€“ *optional*
- **`peptide_site`**: Peptide site position for glycan attachment (integer) â€“ *optional*

Let's create our variable information table:

```{r}
var_info <- tibble(
  variable = c("V1", "V2", "V3"),
  glycan_composition = glyrepr::glycan_composition(
    c(GalNAc = 1),
    c(Gal = 1, GalNAc = 1),
    c(Gal = 1, GalNAc = 1, GlcNAc = 1)
  ),
  glycan_structure = glyrepr::as_glycan_structure(c(
    "GalNAc(a1-",
    "Gal(b1-3)GalNAc(a1-",
    "Gal(b1-3)[GlcNAc(a1-6)]GalNAc(a1-"
  ))
)
var_info
```

## Step 3: Building Your Expression Matrix

Time for the main event â€“ your expression matrix! This is where all your actual measurements live.

The layout is straightforward: **variables as rows, samples as columns**.

You don't need to perform any transformation on your data, especially log-transformation.
`glycoverse` functions will handle the data transformation internally if needed.

### The Matching Game

Here's the important bit: your row names must match the `variable` column from your variable information,
and your column names must match the `sample` column from your sample information.
Think of it as connecting the dots between your data and metadata.

**Bonus:** The order doesn't need to be perfect â€“ the functions are smart enough to line everything up correctly!

Let's create our expression matrix:

```{r}
# Create a simple matrix with 3 variables and 6 samples
expr_mat <- matrix(
  rnorm(18, mean = 10, sd = 2), # Some realistic-looking data
  nrow = 3, 
  ncol = 6
)
rownames(expr_mat) <- var_info$variable
colnames(expr_mat) <- sample_info$sample
expr_mat
```

## Step 4: Bringing It All Together

Congratulations! You've got all the pieces of the puzzle. Now let's assemble your `experiment()` object:

```{r}
exp <- experiment(expr_mat, sample_info, var_info, exp_type = "glycomics", glycan_type = "N")
exp
```

**Don't forget the metadata:** You'll need to specify your experiment type (`"glycomics"` or `"glycoproteomics"`) and
glycan type (like `"N"` for N-linked, `"O"` for O-linked, etc.).
These little details help downstream functions understand exactly what they're working with.

And there you have it â€“ your very own `experiment()` object, ready for all the exciting analyses that await! ðŸŽ‰